{% extends "base.html" %}

{% block title %}{{ event.title }} - Gatherly{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card shadow mb-4">
            {% if event.image_url %}
            <img src="{{ event.image_url }}" class="card-img-top" alt="{{ event.title }}" style="max-height: 400px; object-fit: cover;">
            {% endif %}
            <div class="card-body">
                <span class="badge bg-primary">{{ event.category }}</span>
                <h1 class="card-title mt-2">{{ event.title }}</h1>
                <p class="card-text">{{ event.description|safe }}</p>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <h5>üìÖ –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</h5>
                        <p>{{ event.date.strftime('%d.%m.%Y %H:%M') }}</p>
                    </div>
                    <div class="col-md-6">
                        <h5>üìç –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</h5>
                        <p>{{ event.location }}</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h5>üë§ –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</h5>
                    <p>{{ event.organizer.first_name }} {{ event.organizer.last_name }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card shadow">
            <div class="card-body">
                <h4 class="card-title mb-4">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h4>
                
                {% if event.tickets %}
                    {% for ticket in event.tickets %}
                    <div class="mb-3 p-3 border rounded">
                        <h5>{{ ticket.name }}</h5>
                        <p class="fw-bold">üí∞ {{ ticket.price }} —Ä—É–±.</p>
                        <p>–î–æ—Å—Ç—É–ø–Ω–æ: {{ ticket.quantity - ticket.sold_count }} –∏–∑ {{ ticket.quantity }}</p>
                        
                        {% if current_user.is_authenticated %}
                        <form method="POST" action="{{ url_for('events.book_event', event_id=event.id) }}">
                            {{ form.hidden_tag() }}
                            <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
                            <div class="mb-3">
                                <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤</label>
                                {{ form.tickets_count(class="form-control", min=1, max=ticket.quantity-ticket.sold_count) }}
                            </div>
                            {{ form.submit(class="btn btn-primary w-100") }}
                        </form>
                        {% else %}
                        <a href="{{ url_for('auth.login') }}" class="btn btn-primary w-100">
                            –í–æ–π–¥–∏—Ç–µ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                        </a>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">–ë–∏–ª–µ—Ç—ã –ø–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
